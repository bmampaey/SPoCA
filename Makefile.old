OBJECTS2=classes/objects2/ActiveRegion.o classes/objects2/AIAImage.o classes/objects2/ArgumentHelper.o classes/objects2/Classifier.o classes/objects2/ColorMap.o classes/objects2/Coordinate.o classes/objects2/CoronalHole.o classes/objects2/CumulativeClassifier.o classes/objects2/CumulativeFCMClassifier.o classes/objects2/CumulativePCM2Classifier.o classes/objects2/CumulativePCMClassifier.o classes/objects2/CumulativeSPoCA2Classifier.o classes/objects2/CumulativeSPoCAClassifier.o classes/objects2/EITImage.o classes/objects2/EUVIImage.o classes/objects2/EUVImage.o classes/objects2/FCMClassifier.o classes/objects2/FeatureVector.o classes/objects2/FitsFile.o classes/objects2/Header.o classes/objects2/HistogramClassifier.o classes/objects2/HistogramFCMClassifier.o classes/objects2/HistogramPCM2Classifier.o classes/objects2/HistogramPCMClassifier.o classes/objects2/HMIImage.o classes/objects2/Image.o classes/objects2/MagickImage.o classes/objects2/mainutilities.o classes/objects2/PCM2Classifier.o classes/objects2/PCMClassifier.o classes/objects2/PFCMClassifier.o classes/objects2/Region.o classes/objects2/RegionStats.o classes/objects2/SegmentationStats.o classes/objects2/SPoCA2Classifier.o classes/objects2/SPoCAClassifier.o classes/objects2/STAFFStats.o classes/objects2/SunImage.o classes/objects2/SWAPImage.o classes/objects2/tools.o classes/objects2/trackable.o classes/objects2/WCS.o classes/objects2/trackable.o
OBJECTS1=classes/objects1/ActiveRegion.o classes/objects1/AIAImage.o classes/objects1/ArgumentHelper.o classes/objects1/Classifier.o classes/objects1/ColorMap.o classes/objects1/Coordinate.o classes/objects1/CoronalHole.o classes/objects1/CumulativeClassifier.o classes/objects1/CumulativeFCMClassifier.o classes/objects1/CumulativePCM2Classifier.o classes/objects1/CumulativePCMClassifier.o classes/objects1/CumulativeSPoCA2Classifier.o classes/objects1/CumulativeSPoCAClassifier.o classes/objects1/EITImage.o classes/objects1/EUVIImage.o classes/objects1/EUVImage.o classes/objects1/FCMClassifier.o classes/objects1/FeatureVector.o classes/objects1/FitsFile.o classes/objects1/Header.o classes/objects1/HistogramClassifier.o classes/objects1/HistogramFCMClassifier.o classes/objects1/HistogramPCM2Classifier.o classes/objects1/HistogramPCMClassifier.o classes/objects1/HMIImage.o classes/objects1/Image.o classes/objects1/MagickImage.o classes/objects1/mainutilities.o classes/objects1/PCM2Classifier.o classes/objects1/PCMClassifier.o classes/objects1/PFCMClassifier.o classes/objects1/Region.o classes/objects1/RegionStats.o classes/objects1/SegmentationStats.o classes/objects1/SPoCA2Classifier.o classes/objects1/SPoCAClassifier.o classes/objects1/STAFFStats.o classes/objects1/SunImage.o classes/objects1/SWAPImage.o classes/objects1/tools.o classes/objects1/trackable.o classes/objects1/WCS.o classes/objects1/trackable.o

BINARIES2=bin2/attribution.x bin2/classification.x bin2/contours.x bin2/coordinate_test.x bin2/cumulative_classification.x bin2/dilate_projection_test.x bin2/fits2png.x bin2/get_regions_stats.x bin2/get_segmentation_stats.x bin2/get_STAFF_stats.x bin2/histogram.x bin2/image_derotate.x bin2/image_stat.x bin2/map2png.x bin2/overlay.x bin2/preprocessing.x bin2/projection_test.x bin2/quodiff.x bin2/RGBcomposite.x bin2/uncompres.x bin2/tracking.x
BINARIES1=bin1/attribution.x bin1/classification.x bin1/contours.x bin1/coordinate_test.x bin1/cumulative_classification.x bin1/dilate_projection_test.x bin1/fits2png.x bin1/get_regions_stats.x bin1/get_segmentation_stats.x bin1/get_STAFF_stats.x bin1/histogram.x bin1/image_derotate.x bin1/image_stat.x bin1/map2png.x bin1/overlay.x bin1/preprocessing.x bin1/projection_test.x bin1/quodiff.x bin1/RGBcomposite.x bin1/uncompres.x bin1/tracking.x

CXXFLAGS=-pipe -fPIC -fkeep-inline-functions -g -O3 `Magick++-config --cppflags` -DMAGICK
LDFLAGS=`Magick++-config --ldflags --libs` -lcfitsio -lpthread -Llib

all: onechannel twochannels

onechannel: ${BINARIES1}

twochannels: ${BINARIES2}

# This blank rule prevents make from deleting intermediary object files
.SECONDARY:

bin2/%.x: programs/objects2/%.o lib/libSPoCA2.so
	g++ -o $@ ${LDFLAGS} -lSPoCA2 programs/objects2/$*.o
bin1/%.x: programs/objects1/%.o lib/libSPoCA1.so
	g++ -o $@ ${LDFLAGS} -lSPoCA1 programs/objects1/$*.o

lib/libSPoCA2.so: ${OBJECTS2}
	g++ -o $@ -shared ${LDFLAGS} $?
lib/libSPoCA1.so: ${OBJECTS1}
	g++ -o $@ -shared ${LDFLAGS} $?

programs/objects2/%.o: programs/%.cpp
	g++ -o $@ -c ${CXXFLAGS} -DNUMBERCHANNELS=2 $?
programs/objects1/%.o: programs/%.cpp 
	g++ -o $@ -c ${CXXFLAGS} -DNUMBERCHANNELS=1 $?
classes/objects2/%.o: classes/%.cpp 
	g++ -o $@ -c ${CXXFLAGS} -DNUMBERCHANNELS=2 $?
classes/objects1/%.o: classes/%.cpp 
	g++ -o $@ -c ${CXXFLAGS} -DNUMBERCHANNELS=1 $?

strip: all
	strip lib/*.so bin{1,2}/*.x

clean:
	rm lib/*.so classes/objects{1,2}/*.o bin{1,2}/* programs/objects{1,2}/*.o

